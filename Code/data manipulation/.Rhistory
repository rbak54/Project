install.packages("epimdr")
require(epimdr)
?ode
vector(80,length = 4)
vector(rep(3,3))
?vector
c(rep(3,3))
time = seq(0, 5000,by = 1/10)
temperature=15*sin(2*pi*(time-91)/365)+30
humidity=c(rep(80, length(time))
#parameters from bjornstad book and guesses- just to test functions work! not sure if this is quite right
parmssus = list(mu = 00.0001, sigma=0.25 ,alpha=0.0005, kappa0 = 25, gamma = 1/2,contact=0.7,temp=temperature,humidity=humidity, f=1/900)
]
time = seq(0, 5000,by = 1/10)
temperature=15*sin(2*pi*(time-91)/365)+30
humidity=c(rep(80, length(time))
#parameters from bjornstad book and guesses- just to test functions work! not sure if this is quite right
parmssus = list(mu = 00.0001, sigma=0.25 ,alpha=0.0005, kappa0 = 25, gamma = 1/2,contact=0.7,temp=temperature,humidity=humidity, f=1/900)
]time = seq(0, 5000,by = 1/10)
time = seq(0, 5000,by = 1/10)
time = seq(0, 5000,by = 1/10)
temperature=15*sin(2*pi*(time-91)/365)+30
humidity=c(rep(80, length(time))
humidity=c(rep(80, length(time))
humidity=c(rep(80, length=length(time))
humidity=c(rep(80, length(time)))
humidity=c(rep(80, length(time)))
#parameters from bjornstad book and guesses- just to test functions work! not sure if this is quite right
parmssus = list(mu = 00.0001, sigma=0.25 ,alpha=0.0005, kappa0 = 25, gamma = 1/2,contact=0.7,temp=temperature,humidity=humidity, f=1/900)
start = c(S = 0.999, E=0.001,I = 0.00, R = 0)
log(0)
log(1)
temp/30
temperature/30
log(0.4)
log(1-1)
temperature
temperature=15*sin(2*pi*(time-91)/365)+15
temperature
plot(time,temperature)
temperature/30
plot(time,temperature/30)
plot(time,log(1-temperature/30))
plot(time,(1-temperature/30))
MAX(1-temperature/30)
max(1-temperature/30)
min(1-temperature/30)
plot(time,(1-temperature/60)
)
plot(time,(1-temperature/60)
plot(time,(1-temperature/60))
plot(time,(1-temperature/60))
plot(time,(1-temperature/60)-0.5)
plot(time,(temperature/60)-0.5)
plot(time,(temperature/60))
min(1-temperature/60)
log(0.5)
humidity[1]
humidity[0/1]
S = 0.999
E = 0.001
I = 0.00
R = 0
mu = 00.000,
sigma = 365/5 ,
alpha = 0.0000,
gamma = 72,
f = 0,
N = 1,
nu = 0.0,
theta = 0 ,# where from,
containment = 0.5 , #where from
k = 0.03,
epsilon = 0.4, #where from
beta0 = 2 * 72
infection <- beta0 * I * S / N * (1 + epsilon * cos (2 * pi * (time - theta)) * (1 - containment * I^3 / (k^3 + I^3))
R = 0
mu = 00.000
sigma = 365/5
alpha = 0.0000
gamma = 72
f = 0
N = 1
nu = 0.0
theta = 0 # where from,
containment = 0.5  #where from
k = 0.03
epsilon = 0.4 #where from
beta0 = 2 * 72
infection <- beta0 * I * S / N * (1 + epsilon * cos (2 * pi * (time - theta)) * (1 - containment * I^3 / (k^3 + I^3))
infection <- beta0 * I * S / N * (1 + epsilon * cos (2 * pi * (time - theta))) * (1 - containment * I^3 / (k^3 + I^3))
infection <- beta0 * I * S / N * (1 + epsilon * cos (2 * pi * (time - theta))) * (1 - containment * I^3 / (k^3 + I^3))
install.packages(ncdf4)
install.packages("ncdf4")
read.csv("./Downloads/pnas.1607747113.sd01.txt")
a<-read.csv("./Downloads/pnas.1607747113.sd01.txt")
hist(a$day)
hist(a$value)
require(dplyr)
require(dplyr)
install.packages("dplyr")
require(dplyr)
require(dplyr)
require("deSolve")
require("ggplot2")
require("dpylr")
install.packages("minpack.lm")
setwd("~/Documents/Project/Code/data manipulation")
data<-read.csv("../../Data/converted harper 1961.csv",header =F)
# in this dataset nil becomes 0, trace or n.d becomes NA,and the midpoint of the range is used
#where there is a range I have used the midpoint
data<-as.data.frame(data)
viability<-as.vector(as.matrix((data[4:10,])))
formatted_data<-as.data.frame(matrix(nrow=length(viability),ncol = 11))
formatted_data[,5]<-viability
formatted_data[,4]<-rep(c(1/60/60/24,1/12/24,1/2/24,1/24,4/24,6/24,23/24),length(viability)/7)
formatted_data[,6]<-rep(1:11,each=7)
formatted_data[,1]<-rep(as.vector(as.matrix((data[1,]))),each=7)
formatted_data[,2]<-rep(as.vector(as.matrix((data[2,]))),each=7)
formatted_data[,3]<-rep(as.vector(as.matrix((data[3,]))),each=7)
formatted_data[,3]<-rep(as.vector(as.matrix((data[3,]))),each=7)
colnames(formatted_data)<-c("Temp","Hum","Rep","Time","Viability","Experiment","q1","v0","q2","aic1","aic2")
require("minpack.lm")
times<-seq(0,1,length.out = 100)
par(mfrow=c(3,4))
for (i in (unique(formatted_data$Experiment))){
data_subset<-formatted_data[which(formatted_data[,6]==i),]
#this is model 2
model<-nlsLM(Viability~100*exp(q*Time),data=data_subset,start=list(q=-10))
#plot(times,100*exp(times*summary(model)$parameters[1,1]),"s",ylim=c(0,100))
#points(data_subset$Time,data_subset$Viability,col="blue",cex=1)
formatted_data[which(formatted_data[,6]==i),11]<-AIC(model)
formatted_data[which(formatted_data[,6]==i),9]<-summary(model)$parameters[1,1]
#this is model one
model<-nlsLM(Viability~v0*exp(q*Time),data=data_subset,start=list(v0=100,q=-5),lower = c(v0=0  ,q=-300),upper = c(v0=100  ,q=000))
#
#without limits results look better? not sure which makes more biological sense
formatted_data[which(formatted_data[,6]==i),7]<-summary(model)$parameters[2,1]
formatted_data[which(formatted_data[,6]==i),8]<-summary(model)$parameters[1,1]
formatted_data[which(formatted_data[,6]==i),10]<-AIC(model)
plot(times,summary(model)$parameters[1,1]*exp(times*summary(model)$parameters[2,1]),"s",ylim=c(0,100))
points(data_subset$Time,data_subset$Viability,col="blue",cex=1)
}
par(mfrow=c(3,4))
for (i in (unique(formatted_data$Experiment))){
data_subset<-formatted_data[which(formatted_data[,6]==i),]
#this is model 2
model<-nlsLM(Viability~100*exp(q*Time),data=data_subset,start=list(q=-10))
#plot(times,100*exp(times*summary(model)$parameters[1,1]),"s",ylim=c(0,100))
#points(data_subset$Time,data_subset$Viability,col="blue",cex=1)
formatted_data[which(formatted_data[,6]==i),11]<-AIC(model)
formatted_data[which(formatted_data[,6]==i),9]<-summary(model)$parameters[1,1]
#this is model one
model<-nlsLM(Viability~v0*exp(q*Time),data=data_subset,start=list(v0=100,q=-5),lower = c(v0=0  ,q=-300),upper = c(v0=100  ,q=000))
#
#without limits results look better? not sure which makes more biological sense
formatted_data[which(formatted_data[,6]==i),7]<-summary(model)$parameters[2,1]
formatted_data[which(formatted_data[,6]==i),8]<-summary(model)$parameters[1,1]
formatted_data[which(formatted_data[,6]==i),10]<-AIC(model)
plot(times,summary(model)$parameters[1,1]*exp(times*summary(model)$parameters[2,1]),"s",ylim=c(0,100))
points(data_subset$Time,data_subset$Viability,col="blue",cex=1)
}
seq(1,77,by=7)
shrunk_data<-formatted_data[seq(1,77,by=7),c(1,2,3,6,7,8,9,10,11)]
shrunk_data
#first model best for all but 1 eg so just use first model?
par(mfrow=c(2,3))
plot(shrunk_data$Temp,shrunk_data$q1)
plot(shrunk_data$Temp,shrunk_data$q2)
plot(shrunk_data$Temp,shrunk_data$v0)
plot(shrunk_data$Hum,shrunk_data$q1)
plot(shrunk_data$Hum,shrunk_data$q2)
plot(shrunk_data$Hum,shrunk_data$v0)
par(mfrow=c(2,2))
plot(shrunk_data$Temp,shrunk_data$q1)
plot(shrunk_data$Hum,shrunk_data$q1)
shrunk_data_repeats<-as.data.frame(matrix(NA,ncol=ncol(shrunk_data),nrow = sum(shrunk_data$Rep)))
colnames(shrunk_data_repeats)=colnames(shrunk_data)
index<-0
for (i in 1:nrow(shrunk_data)) {
shrunk_data_repeats[(index+1):(index+shrunk_data$Rep[i]) , ] <-shrunk_data[i,]
index<-index+shrunk_data$Rep[i]
}
Hums<-seq(0,100,length.out = 1000)
Hum_Model<-nlsLM(q1~q0*exp(Hum*g),data=shrunk_data_repeats[,c(2,5)],start = list(g=0,q0=0))
g<-summary(Hum_Model)$coefficients[1,1]
q0<-summary(Hum_Model)$coefficients[2,1]
plot(Hums,q0*exp(g*Hums),"s")
points(shrunk_data_repeats$Hum,shrunk_data_repeats$q1)
shrunk_data_repeats
